<Page x:Class="TileGame.Views.GameView"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:vm="clr-namespace:TileGame.ViewModels"
      xmlns:helpers="clr-namespace:TileGame.Helpers"
      xmlns:i="http://schemas.microsoft.com/xaml/behaviors"
      Title="Game View" Width="1920" Height="1080">
    <Page.Resources>
        <helpers:EnumToImagePathConverter x:Key="TileImageConverter"/>
        <helpers:ItemEnumToImagePathConverter x:Key="ItemImageConverter"/>
    </Page.Resources>
    <Grid>
        <Canvas>
            <ItemsControl x:Name="tiles" ItemsSource="{Binding BoardViewModel.Tiles}">
                <ItemsControl.ItemContainerStyle>
                    <Style>
                        <Setter Property="Canvas.Left" Value="{Binding Path=X}"/>
                        <Setter Property="Canvas.Top" Value="{Binding Path=Y}"/>
                    </Style>
                </ItemsControl.ItemContainerStyle>
                <ItemsControl.ItemsPanel>
                    <ItemsPanelTemplate>
                        <Canvas IsItemsHost="True"/>
                    </ItemsPanelTemplate>
                </ItemsControl.ItemsPanel>
                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <Image Source="{Binding Type, Converter={StaticResource TileImageConverter}}" Width="{Binding Size}" Height="{Binding Size}">
                            <i:Interaction.Triggers>
                                <i:EventTrigger EventName="MouseLeftButtonDown">
                                    <i:InvokeCommandAction Command="{Binding DataContext.TileClick, ElementName=tiles}" CommandParameter="{Binding}"/>
                                </i:EventTrigger>
                            </i:Interaction.Triggers>
                        </Image>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
            <ItemsControl x:Name="playerItems" ItemsSource="{Binding PlayerViewModel.Inventory.Items}" Panel.ZIndex="1">
                <ItemsControl.ItemsPanel>
                    <ItemsPanelTemplate>
                        <StackPanel Orientation="Horizontal" Width="1920">
                        </StackPanel>
                    </ItemsPanelTemplate>
                </ItemsControl.ItemsPanel>
                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <StackPanel Height="48">
                            <Image Source="{Binding Key, Converter={StaticResource ItemImageConverter}}" Width="24" Height="24">
                                <Image.ToolTip>
                                    <StackPanel Background="White">
                                        <TextBlock Text="{Binding Key}"/>
                                        <TextBlock Text="{Binding Value.Description}"/>
                                    </StackPanel>
                                </Image.ToolTip>
                            </Image>
                            <Label Content="{Binding Value.Count}" FontWeight="Bold" FontSize="16" HorizontalAlignment="Center"/>
                        </StackPanel>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
        </Canvas>
    </Grid>
</Page>
